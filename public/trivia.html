<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trivia üß† ‚Äî Cat in a Cradle</title>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <script>
    const _c = document.createElement('canvas'); _c.width = _c.height = 64;
    const _x = _c.getContext('2d'); _x.font = '52px serif'; _x.textAlign = 'center'; _x.textBaseline = 'middle';
    _x.fillText('üê±', 32, 36);
    const _l = document.createElement('link'); _l.rel = 'shortcut icon'; _l.href = _c.toDataURL(); document.head.appendChild(_l);
  </script>
  <link rel="stylesheet" href="/style.css" />
  <style>
    body { overflow: auto; }

    /* ‚îÄ‚îÄ Shared ‚îÄ‚îÄ */
    .tv-title {
      font-size: 2rem;
      font-weight: 900;
      letter-spacing: -0.02em;
      text-align: center;
      margin-bottom: 0.25rem;
    }
    .tv-tagline { text-align: center; color: var(--text-dim); margin-bottom: 1.5rem; font-size: 0.9rem; }

    /* ‚îÄ‚îÄ Lobby ‚îÄ‚îÄ */
    #screen-lobby .lobby-card { max-height: 90vh; overflow-y: auto; }

    .tabs { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; }
    .tab-btn {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: transparent;
      color: var(--text-dim);
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.15s;
    }
    .tab-btn.active {
      background: #8b5cf6;
      border-color: #8b5cf6;
      color: #fff;
    }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    .settings-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    /* ‚îÄ‚îÄ Waiting room ‚îÄ‚îÄ */
    #screen-waiting .lobby-card { width: 520px; }

    .room-code-display {
      text-align: center;
      margin: 1rem 0;
    }
    .room-code-display .code {
      font-size: 2.5rem;
      font-weight: 900;
      letter-spacing: 0.15em;
      color: #8b5cf6;
      font-family: monospace;
    }
    .code-label { font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.08em; }

    .player-list { margin: 1rem 0; }
    .player-list-title {
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-dim);
      margin-bottom: 0.5rem;
    }
    .player-list-items { display: flex; flex-direction: column; gap: 0.4rem; }
    .player-item {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.5rem 0.75rem;
      background: var(--surface2);
      border-radius: 8px;
      font-size: 0.9rem;
    }
    .player-avatar {
      width: 28px; height: 28px;
      border-radius: 50%;
      background: #8b5cf6;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      color: #fff;
      flex-shrink: 0;
    }
    .player-crown { font-size: 0.9rem; margin-left: auto; }

    /* ‚îÄ‚îÄ Game screen ‚îÄ‚îÄ */
    #screen-game {
      width: 100vw;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      padding: 0;
    }
    #screen-game.hidden { display: none !important; }

    /* Top bar */
    .tv-topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 0.75rem 1.5rem;
      flex-shrink: 0;
    }
    .tv-round-info { font-size: 0.85rem; color: var(--text-dim); }
    .tv-round-info strong { color: var(--text); }

    /* Timer arc */
    .tv-timer-wrap { position: relative; width: 52px; height: 52px; }
    .tv-timer-svg { width: 52px; height: 52px; transform: rotate(-90deg); }
    .tv-timer-track {
      fill: none;
      stroke: var(--border);
      stroke-width: 4;
    }
    .tv-timer-arc {
      fill: none;
      stroke: #8b5cf6;
      stroke-width: 4;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.9s linear, stroke 0.3s;
    }
    .tv-timer-num {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 800;
    }

    /* Main layout */
    .tv-main {
      display: grid;
      grid-template-columns: 1fr 260px;
      gap: 0;
      flex: 1;
      min-height: 0;
    }

    /* Center panel */
    .tv-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem 2rem;
      gap: 1.25rem;
    }

    /* ‚îÄ‚îÄ Vote UI ‚îÄ‚îÄ */
    .tv-vote-label {
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-dim);
    }
    .tv-vote-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
      max-width: 520px;
      width: 100%;
    }
    .tv-vote-btn {
      padding: 1rem 0.75rem;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.15s;
      text-align: center;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text);
    }
    .tv-vote-btn:hover:not(:disabled) {
      border-color: #8b5cf6;
      background: rgba(139,92,246,0.08);
    }
    .tv-vote-btn.voted {
      border-color: #8b5cf6;
      background: rgba(139,92,246,0.15);
      color: #8b5cf6;
    }
    .tv-vote-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .tv-vote-emoji { font-size: 1.8rem; display: block; margin-bottom: 0.25rem; }

    .tv-vote-status {
      font-size: 0.85rem;
      color: var(--text-dim);
    }

    /* ‚îÄ‚îÄ Question UI ‚îÄ‚îÄ */
    .tv-question-category {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background: rgba(139,92,246,0.12);
      border: 1px solid rgba(139,92,246,0.3);
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 700;
      color: #8b5cf6;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .tv-question-difficulty {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-left: 0.5rem;
    }
    .tv-diff-easy { background: rgba(34,197,94,0.15); color: var(--green); }
    .tv-diff-medium { background: rgba(234,179,8,0.15); color: var(--yellow); }
    .tv-diff-hard { background: rgba(239,68,68,0.15); color: #ef4444; }

    .tv-question-text {
      font-size: 1.4rem;
      font-weight: 800;
      text-align: center;
      max-width: 640px;
      line-height: 1.4;
    }

    .tv-answers-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      max-width: 600px;
      width: 100%;
    }
    .tv-answer-btn {
      padding: 1rem 1.25rem;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.15s;
      text-align: left;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .tv-answer-btn:hover:not(:disabled):not(.revealed) {
      border-color: #8b5cf6;
      background: rgba(139,92,246,0.08);
    }
    .tv-answer-btn.selected {
      border-color: #8b5cf6;
      background: rgba(139,92,246,0.15);
    }
    .tv-answer-btn:disabled { cursor: not-allowed; }
    .tv-answer-btn.revealed.correct {
      border-color: var(--green);
      background: rgba(34,197,94,0.15);
    }
    .tv-answer-btn.revealed.wrong {
      border-color: #ef4444;
      background: rgba(239,68,68,0.1);
      opacity: 0.6;
    }
    .tv-answer-btn.revealed.selected.wrong {
      opacity: 1;
      border-color: #ef4444;
      background: rgba(239,68,68,0.2);
    }
    .tv-answer-letter {
      width: 28px; height: 28px;
      border-radius: 6px;
      background: var(--surface2);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.8rem;
      font-weight: 800;
      flex-shrink: 0;
    }
    .tv-answer-text { flex: 1; }

    .tv-answer-status {
      font-size: 0.85rem;
      color: var(--text-dim);
    }

    /* ‚îÄ‚îÄ Reveal results ‚îÄ‚îÄ */
    .tv-reveal-results {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      max-width: 600px;
    }
    .tv-reveal-player {
      padding: 0.3rem 0.65rem;
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    .tv-reveal-player.correct {
      background: rgba(34,197,94,0.15);
      color: var(--green);
    }
    .tv-reveal-player.wrong {
      background: rgba(239,68,68,0.1);
      color: #ef4444;
    }

    /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
    .tv-sidebar {
      border-left: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .tv-sidebar-section {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .tv-sidebar-title {
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: var(--text-dim);
      margin-bottom: 0.6rem;
    }

    .score-list { display: flex; flex-direction: column; gap: 0.35rem; }
    .score-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      padding: 0.3rem 0;
      border-radius: 6px;
    }
    .score-rank { width: 18px; font-size: 0.75rem; color: var(--text-dim); text-align: center; }
    .score-name { flex: 1; font-weight: 600; }
    .score-pts { font-weight: 700; color: var(--yellow); font-size: 0.8rem; }
    .score-item.is-me .score-name::after { content: ' (you)'; color: var(--text-dim); font-weight: 400; }

    /* ‚îÄ‚îÄ Overlays ‚îÄ‚îÄ */
    .tv-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,15,26,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .tv-overlay.hidden { display: none !important; }

    .tv-overlay-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 2rem 2.5rem;
      min-width: 320px;
      max-width: 480px;
      text-align: center;
      box-shadow: var(--shadow);
    }
    .tv-overlay-title {
      font-size: 1.5rem;
      font-weight: 900;
      margin-bottom: 1rem;
    }
    .tv-overlay-scores { margin: 1rem 0; text-align: left; }
    .overlay-score-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0;
      border-bottom: 1px solid var(--border);
      font-size: 0.9rem;
    }
    .overlay-score-row:last-child { border-bottom: none; }
    .overlay-rank { width: 22px; text-align: center; color: var(--text-dim); font-size: 0.8rem; }
    .overlay-name { flex: 1; font-weight: 600; }
    .overlay-pts { font-weight: 700; color: var(--yellow); }

    /* General button styles */
    .btn {
      display: inline-block;
      padding: 0.6rem 1.5rem;
      border-radius: 10px;
      font-size: 0.95rem;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: background 0.15s;
    }
    .btn-primary { background: #8b5cf6; color: #fff; }
    .btn-primary:hover { background: #7c3aed; }
    .btn-secondary { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { border-color: #8b5cf6; color: #8b5cf6; }
    .btn-full { width: 100%; margin-top: 0.5rem; padding: 0.7rem; }

    /* Misc */
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      color: var(--text-dim);
      text-decoration: none;
      font-size: 0.85rem;
      margin-bottom: 1rem;
      transition: color 0.15s;
    }
    .back-link:hover { color: var(--text); }

    .copy-btn {
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text-dim);
      padding: 0.35rem 0.75rem;
      border-radius: 6px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.15s;
    }
    .copy-btn:hover { border-color: #8b5cf6; color: #8b5cf6; }

    /* Responsive */
    @media (max-width: 640px) {
      .tv-main { grid-template-columns: 1fr; }
      .tv-sidebar { border-left: none; border-top: 1px solid var(--border); max-height: 200px; }
      .settings-grid { grid-template-columns: 1fr; }
      .tv-vote-grid { grid-template-columns: repeat(2, 1fr); }
      .tv-answers-grid { grid-template-columns: 1fr; }
      .tv-question-text { font-size: 1.1rem; }
    }
  </style>
</head>
<body>

  <!-- ‚îÄ‚îÄ Lobby ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="screen-lobby" class="screen">
    <div class="lobby-card">
      <a href="/" class="back-link">‚Üê Back to Hub</a>
      <div class="tv-title">üß† Trivia</div>
      <p class="tv-tagline">Vote on a category, then race to answer correctly!</p>

      <!-- Direct-join panel (shown when arriving via invite link) -->
      <div id="lobby-direct-join" class="hidden">
        <p style="color:var(--text-dim);font-size:0.9rem;margin-bottom:1rem;text-align:center">You've been invited! Enter your name to jump in.</p>
        <div class="input-group">
          <label class="input-label">Your name</label>
          <input id="inp-username-direct" class="input-field" type="text" placeholder="Enter your name" maxlength="20" autocomplete="off" />
        </div>
        <button id="btn-direct-join" class="btn btn-primary btn-full">Join Game ‚Üí</button>
        <p style="text-align:center;margin-top:0.75rem">
          <button id="btn-back-to-lobby" style="background:none;border:none;color:var(--text-dim);font-size:0.85rem;cursor:pointer">‚Üê Back to lobby</button>
        </p>
      </div>

      <div id="lobby-username-step">
        <div class="input-group">
          <label class="input-label">Your name</label>
          <input id="inp-username" class="input-field" type="text" placeholder="Enter your name" maxlength="20" autocomplete="off" />
        </div>
        <button id="btn-continue" class="btn btn-primary btn-full">Continue ‚Üí</button>
      </div>

      <div id="lobby-choice-step" class="hidden">
        <div class="tabs">
          <button class="tab-btn active" data-tab="create">Create Room</button>
          <button class="tab-btn" data-tab="join">Join Room</button>
        </div>

        <!-- Create tab -->
        <div id="tab-create" class="tab-panel active">
          <div class="settings-grid">
            <div class="input-group">
              <label class="input-label">Rounds</label>
              <select id="inp-rounds" class="input-field">
                <option value="5">5 rounds</option>
                <option value="10" selected>10 rounds</option>
                <option value="15">15 rounds</option>
              </select>
            </div>
            <div class="input-group">
              <label class="input-label">Time per question</label>
              <select id="inp-time" class="input-field">
                <option value="15">15 seconds</option>
                <option value="20" selected>20 seconds</option>
                <option value="25">25 seconds</option>
                <option value="30">30 seconds</option>
              </select>
            </div>
          </div>
          <button id="btn-create" class="btn btn-primary btn-full">Create Room</button>
        </div>

        <!-- Join tab -->
        <div id="tab-join" class="tab-panel">
          <div class="input-group">
            <label class="input-label">Room code</label>
            <input id="inp-room-code" class="input-field" type="text" placeholder="e.g. ABCD12" maxlength="6"
              autocomplete="off" style="text-transform:uppercase;letter-spacing:0.1em" />
          </div>
          <button id="btn-join" class="btn btn-primary btn-full">Join Room</button>
        </div>
      </div>

      <p id="lobby-error" class="hidden" style="color:#8b5cf6;font-size:0.85rem;margin-top:0.75rem;text-align:center"></p>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Waiting Room ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="screen-waiting" class="screen hidden">
    <div class="lobby-card" style="width:520px">
      <a href="/" class="back-link">‚Üê Leave room</a>
      <div class="tv-title">üß† Trivia</div>
      <div class="room-code-display">
        <div class="code-label">Room Code</div>
        <div class="code" id="waiting-room-code">------</div>
        <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:0.4rem">
          <button class="copy-btn" id="btn-copy-code">Copy Code</button>
          <button class="copy-btn" id="btn-copy-link">üîó Invite Link</button>
        </div>
        <p id="link-copied-msg" class="hidden" style="font-size:0.75rem;color:var(--green);margin-top:0.3rem">Link copied!</p>
      </div>

      <div class="player-list">
        <div class="player-list-title">Players (<span id="waiting-player-count">0</span>/12)</div>
        <div class="player-list-items" id="waiting-players"></div>
      </div>

      <p id="waiting-hint" style="font-size:0.8rem;color:var(--text-dim);text-align:center;margin-bottom:0.75rem">
        Share the room code with friends!
      </p>

      <button id="btn-start" class="btn btn-primary btn-full hidden">Start Game</button>
      <p id="waiting-not-owner" class="hidden" style="text-align:center;color:var(--text-dim);font-size:0.85rem">
        Waiting for the host to start‚Ä¶
      </p>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Game Screen ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="screen-game" class="hidden" style="display:none">

    <!-- Top bar -->
    <div class="tv-topbar">
      <div class="tv-round-info" style="display:flex;align-items:center;gap:1rem">
        <a href="/" style="color:var(--text-dim);text-decoration:none;font-size:0.85rem;transition:color 0.15s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--text-dim)'">‚åÇ Home</a>
        <span>Round <strong id="hud-round">1</strong> / <span id="hud-total-rounds">10</span></span>
      </div>
      <div id="hud-phase" style="font-size:0.9rem;font-weight:700;color:#8b5cf6">Vote</div>
      <div style="display:flex;align-items:center;gap:0.75rem">
        <div class="tv-timer-wrap">
          <svg class="tv-timer-svg" viewBox="0 0 52 52">
            <circle class="tv-timer-track" cx="26" cy="26" r="22"/>
            <circle class="tv-timer-arc" id="timer-arc" cx="26" cy="26" r="22"
              stroke-dasharray="138.2" stroke-dashoffset="0"/>
          </svg>
          <div class="tv-timer-num" id="hud-timer">10</div>
        </div>
      </div>
    </div>

    <!-- Main layout -->
    <div class="tv-main">

      <!-- Center -->
      <div class="tv-center" id="tv-center">
        <!-- Vote / Question / Reveal content injected dynamically -->
      </div>

      <!-- Sidebar -->
      <div class="tv-sidebar">
        <div class="tv-sidebar-section">
          <div class="tv-sidebar-title">Scoreboard</div>
          <div class="score-list" id="score-list"></div>
        </div>
      </div>

    </div>
  </div>

  <!-- ‚îÄ‚îÄ Game End Overlay ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="overlay-game-end" class="tv-overlay hidden">
    <div class="tv-overlay-card">
      <div style="font-size:2.5rem;margin-bottom:0.5rem">üèÜ</div>
      <div class="tv-overlay-title" id="game-end-winner">Game Over!</div>
      <div class="tv-overlay-scores" id="game-end-scores"></div>
      <div style="margin-top:1rem;display:flex;gap:0.75rem;justify-content:center">
        <button id="btn-play-again" class="btn btn-primary">Play Again</button>
        <a href="/" class="btn btn-secondary">Exit</a>
      </div>
      <p style="color:var(--text-dim);font-size:0.8rem;margin-top:0.75rem" id="game-end-countdown"></p>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/sounds.js"></script>
  <script src="/trivia.js"></script>
</body>
</html>
