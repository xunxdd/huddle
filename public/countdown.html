<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Countdown üéØ ‚Äî Cat in a Cradle</title>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <script>
    const _c = document.createElement('canvas'); _c.width = _c.height = 64;
    const _x = _c.getContext('2d'); _x.font = '52px serif'; _x.textAlign = 'center'; _x.textBaseline = 'middle';
    _x.fillText('üê±', 32, 36);
    const _l = document.createElement('link'); _l.rel = 'shortcut icon'; _l.href = _c.toDataURL(); document.head.appendChild(_l);
  </script>
  <link rel="stylesheet" href="/style.css" />
  <style>
    body { overflow: auto; }

    /* ‚îÄ‚îÄ Amber theme ‚îÄ‚îÄ */
    :root {
      --cd-amber:        #f59e0b;
      --cd-amber-dim:    rgba(245,158,11,0.13);
      --cd-amber-border: rgba(245,158,11,0.38);
      --cd-amber-hover:  #d97706;
    }

    /* ‚îÄ‚îÄ Shared ‚îÄ‚îÄ */
    .cd-title {
      font-size: 2rem; font-weight: 900;
      letter-spacing: -0.02em; text-align: center; margin-bottom: 0.25rem;
    }
    .cd-tagline { text-align: center; color: var(--text-dim); margin-bottom: 1.5rem; font-size: 0.9rem; }

    /* ‚îÄ‚îÄ Lobby ‚îÄ‚îÄ */
    #screen-lobby .lobby-card { max-height: 90vh; overflow-y: auto; }

    .tabs { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; }
    .tab-btn {
      flex: 1; padding: 0.5rem;
      border: 1px solid var(--border); border-radius: 8px;
      background: transparent; color: var(--text-dim);
      font-weight: 600; font-size: 0.9rem; cursor: pointer;
      transition: all 0.15s;
    }
    .tab-btn.active { background: var(--cd-amber); border-color: var(--cd-amber); color: #000; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    .settings-grid {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 0.75rem; margin-bottom: 1rem;
    }

    /* ‚îÄ‚îÄ Waiting room ‚îÄ‚îÄ */
    #screen-waiting .lobby-card { width: 520px; }

    .room-code-display { text-align: center; margin: 1rem 0; }
    .room-code-display .code {
      font-size: 2.5rem; font-weight: 900;
      letter-spacing: 0.15em; color: var(--cd-amber); font-family: monospace;
    }
    .code-label { font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.08em; }

    .player-list { margin: 1rem 0; }
    .player-list-title {
      font-size: 0.7rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: 0.08em;
      color: var(--text-dim); margin-bottom: 0.5rem;
    }
    .player-list-items { display: flex; flex-direction: column; gap: 0.4rem; }
    .player-item {
      display: flex; align-items: center; gap: 0.6rem;
      padding: 0.5rem 0.75rem;
      background: var(--surface2); border-radius: 8px; font-size: 0.9rem;
    }
    .player-avatar {
      width: 28px; height: 28px; border-radius: 50%;
      background: var(--cd-amber);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.75rem; font-weight: 700; color: #000; flex-shrink: 0;
    }
    .player-crown { font-size: 0.9rem; margin-left: auto; }

    /* ‚îÄ‚îÄ Game screen ‚îÄ‚îÄ */
    #screen-game {
      width: 100vw; min-height: 100vh;
      display: flex; flex-direction: column; align-items: stretch; padding: 0;
    }
    #screen-game.hidden { display: none !important; }

    /* Top bar */
    .cd-topbar {
      display: flex; align-items: center; justify-content: space-between;
      background: var(--surface); border-bottom: 1px solid var(--border);
      padding: 0.75rem 1.5rem; flex-shrink: 0;
    }
    .cd-round-info { font-size: 0.85rem; color: var(--text-dim); display: flex; align-items: center; gap: 1rem; }
    .cd-round-info strong { color: var(--text); }

    /* Timer */
    .cd-timer-wrap { position: relative; width: 52px; height: 52px; }
    .cd-timer-svg { width: 52px; height: 52px; transform: rotate(-90deg); }
    .cd-timer-track { fill: none; stroke: var(--border); stroke-width: 4; }
    .cd-timer-arc {
      fill: none; stroke: var(--cd-amber); stroke-width: 4; stroke-linecap: round;
      transition: stroke-dashoffset 0.9s linear, stroke 0.3s;
    }
    .cd-timer-num {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 1rem; font-weight: 800;
    }

    /* Main layout */
    .cd-main {
      display: grid; grid-template-columns: 1fr 300px;
      gap: 0; flex: 1; min-height: 0;
    }

    /* Center panel */
    .cd-center {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 2rem; gap: 1.25rem;
    }

    /* Target display */
    .cd-target-wrap { text-align: center; }
    .cd-target-label {
      font-size: 0.65rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: 0.1em;
      color: var(--cd-amber); margin-bottom: 0.4rem;
    }
    .cd-target-number {
      font-size: 3.5rem; font-weight: 900; font-family: monospace;
      color: var(--cd-amber);
      background: var(--cd-amber-dim);
      border: 2px solid var(--cd-amber-border);
      border-radius: 14px;
      padding: 0.4rem 1.75rem;
      letter-spacing: 0.05em;
      min-width: 200px; display: inline-block; text-align: center;
    }

    /* Number cards */
    .cd-cards { display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center; }
    .cd-card {
      width: 72px; height: 72px; border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.6rem; font-weight: 900;
      cursor: pointer; transition: transform 0.1s, box-shadow 0.15s;
      border: 2px solid transparent; user-select: none;
    }
    .cd-card:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
    .cd-card:active { transform: translateY(0); }
    .cd-card.c-0 { background: rgba(245,158,11,0.18); border-color: rgba(245,158,11,0.45); color: #f59e0b; }
    .cd-card.c-1 { background: rgba(249,115,22,0.18); border-color: rgba(249,115,22,0.45); color: #f97316; }
    .cd-card.c-2 { background: rgba(234,179,8, 0.18); border-color: rgba(234,179,8, 0.45); color: #eab308; }
    .cd-card.c-3 { background: rgba(217,119,6, 0.18); border-color: rgba(217,119,6, 0.45); color: #d97706; }
    .cd-card.c-4 { background: rgba(251,191,36,0.18); border-color: rgba(251,191,36,0.45); color: #fbbf24; }
    .cd-card.c-5 { background: rgba(245,158,11,0.13); border-color: rgba(245,158,11,0.35); color: #f59e0b; }
    .cd-card.used { opacity: 0.3; cursor: default; transform: none; }

    /* Expression input */
    .cd-expr-wrap {
      width: 100%; max-width: 480px;
      background: var(--surface2); border: 2px solid var(--border);
      border-radius: 12px; padding: 0.75rem 1rem;
      transition: border-color 0.15s;
    }
    .cd-expr-wrap.valid   { border-color: var(--cd-amber); }
    .cd-expr-wrap.invalid { border-color: var(--accent); }
    .cd-expr-wrap.locked  { border-color: var(--green); }

    .cd-expr-input {
      width: 100%; background: transparent; border: none; outline: none;
      color: var(--text); font-size: 1.2rem; font-weight: 600; font-family: monospace;
    }
    .cd-expr-result {
      font-size: 0.82rem; margin-top: 0.3rem; color: var(--text-dim); min-height: 1.1rem;
    }
    .cd-expr-result.exact  { color: var(--cd-amber); font-weight: 700; }
    .cd-expr-result.close  { color: var(--green); }
    .cd-expr-result.far    { color: var(--text-dim); }
    .cd-expr-result.err    { color: var(--accent); }
    .cd-expr-result.locked { color: var(--green); font-weight: 600; }

    /* Operator buttons */
    .cd-ops {
      display: flex; gap: 0.4rem; flex-wrap: wrap; justify-content: center;
      max-width: 480px; width: 100%;
    }
    .cd-op-btn {
      padding: 0.45rem 0.9rem; border-radius: 8px;
      background: var(--surface2); border: 1px solid var(--border);
      color: var(--text); font-size: 1rem; font-weight: 700;
      cursor: pointer; transition: background 0.12s, border-color 0.12s;
      font-family: monospace;
    }
    .cd-op-btn:hover { background: var(--surface); border-color: var(--cd-amber); color: var(--cd-amber); }

    /* Submit button */
    .cd-submit-btn {
      width: 100%; max-width: 480px;
      padding: 0.75rem; border-radius: 10px;
      background: var(--cd-amber); color: #000; border: none;
      font-size: 1rem; font-weight: 700; cursor: pointer;
      transition: background 0.15s;
    }
    .cd-submit-btn:hover:not(:disabled) { background: var(--cd-amber-hover); }
    .cd-submit-btn:disabled { opacity: 0.45; cursor: not-allowed; }
    .cd-submit-btn.locked-in { background: var(--green); color: #fff; }

    .cd-feedback {
      height: 1.4rem; font-size: 0.9rem; font-weight: 600; text-align: center;
    }
    .cd-feedback.ok  { color: var(--green); }
    .cd-feedback.err { color: var(--accent); }

    /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
    .cd-sidebar {
      border-left: 1px solid var(--border);
      display: flex; flex-direction: column; overflow-y: auto;
    }
    .cd-sidebar-section { padding: 1rem; border-bottom: 1px solid var(--border); }
    .cd-sidebar-title {
      font-size: 0.65rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: 0.09em;
      color: var(--text-dim); margin-bottom: 0.6rem;
    }

    /* Player status list */
    .cd-player-status-list { display: flex; flex-direction: column; gap: 0.35rem; }
    .cd-player-status-item {
      display: flex; align-items: center; gap: 0.5rem;
      font-size: 0.85rem; padding: 0.3rem 0;
    }
    .cd-player-status-name { flex: 1; font-weight: 600; }
    .cd-player-status-name.is-me::after { content: ' (you)'; color: var(--text-dim); font-weight: 400; }
    .cd-player-status-pts { font-size: 0.78rem; color: var(--yellow); font-weight: 700; }
    .cd-player-status-check {
      font-size: 0.9rem; width: 20px; text-align: center;
      color: var(--cd-amber); transition: opacity 0.2s;
    }
    .cd-player-status-check.waiting { opacity: 0; }

    /* Score list */
    .score-list { display: flex; flex-direction: column; gap: 0.35rem; }
    .score-item {
      display: flex; align-items: center; gap: 0.5rem;
      font-size: 0.85rem; padding: 0.3rem 0; border-radius: 6px;
    }
    .score-rank { width: 18px; font-size: 0.75rem; color: var(--text-dim); text-align: center; }
    .score-name { flex: 1; font-weight: 600; }
    .score-pts  { font-weight: 700; color: var(--yellow); font-size: 0.8rem; }
    .score-item.is-me .score-name::after { content: ' (you)'; color: var(--text-dim); font-weight: 400; }

    /* Last round recap */
    .cd-recap { padding: 1rem; font-size: 0.82rem; }
    .cd-recap-title { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.09em; color: var(--text-dim); margin-bottom: 0.6rem; }
    .cd-recap-row { padding: 0.2rem 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .cd-recap-row:last-child { border-bottom: none; }
    .cd-recap-name { font-weight: 600; color: var(--text); }
    .cd-recap-expr { font-family: monospace; color: var(--text-dim); font-size: 0.78rem; word-break: break-all; }
    .cd-recap-pts  { font-weight: 700; color: var(--cd-amber); }
    .cd-recap-solution { margin-top: 0.5rem; color: var(--text-dim); }
    .cd-recap-solution span { color: var(--yellow); font-family: monospace; }

    /* ‚îÄ‚îÄ Overlays ‚îÄ‚îÄ */
    .cd-overlay {
      position: fixed; inset: 0;
      background: rgba(15,15,26,0.88);
      display: flex; align-items: center; justify-content: center;
      z-index: 100;
    }
    .cd-overlay.hidden { display: none !important; }

    .cd-overlay-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 20px; padding: 2rem 2.5rem;
      min-width: 320px; max-width: 520px; width: 90%;
      text-align: center; box-shadow: var(--shadow);
      max-height: 90vh; overflow-y: auto;
    }
    .cd-overlay-title { font-size: 1.5rem; font-weight: 900; margin-bottom: 0.75rem; }
    .cd-overlay-sub   { font-size: 0.9rem; color: var(--text-dim); margin-bottom: 1.25rem; }

    /* Pick overlay */
    .cd-pick-btns { display: flex; gap: 0.6rem; flex-wrap: wrap; justify-content: center; margin: 1rem 0; }
    .cd-pick-btn {
      padding: 0.6rem 1rem; border-radius: 10px;
      background: var(--cd-amber-dim); border: 2px solid var(--cd-amber-border);
      color: var(--cd-amber); font-size: 1rem; font-weight: 700;
      cursor: pointer; transition: all 0.15s; min-width: 72px;
    }
    .cd-pick-btn:hover { background: var(--cd-amber); color: #000; border-color: var(--cd-amber); }
    .cd-pick-btn-label { font-size: 0.7rem; color: var(--text-dim); margin-top: 0.1rem; }

    .cd-spinner {
      display: inline-block; width: 28px; height: 28px;
      border: 3px solid var(--border); border-top-color: var(--cd-amber);
      border-radius: 50%; animation: cd-spin 0.8s linear infinite;
      margin: 0.75rem auto;
    }
    @keyframes cd-spin { to { transform: rotate(360deg); } }

    .cd-pick-counter {
      font-size: 0.85rem; color: var(--text-dim); margin-top: 0.5rem;
    }

    /* Round end overlay */
    .cd-results-table { width: 100%; border-collapse: collapse; margin: 0.75rem 0; font-size: 0.84rem; text-align: left; }
    .cd-results-table th {
      font-size: 0.65rem; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.07em; color: var(--text-dim); padding: 0.3rem 0.4rem;
      border-bottom: 1px solid var(--border);
    }
    .cd-results-table td {
      padding: 0.4rem 0.4rem; border-bottom: 1px solid rgba(255,255,255,0.05);
      vertical-align: middle;
    }
    .cd-results-table tr:last-child td { border-bottom: none; }
    .cd-results-table .td-name  { font-weight: 600; }
    .cd-results-table .td-expr  { font-family: monospace; font-size: 0.78rem; color: var(--text-dim); max-width: 140px; word-break: break-all; }
    .cd-results-table .td-val   { font-family: monospace; }
    .cd-results-table .td-diff  { color: var(--text-dim); }
    .cd-results-table .td-pts   { font-weight: 700; color: var(--cd-amber); }
    .cd-results-table .row-exact .td-val  { color: var(--cd-amber); font-weight: 700; }
    .cd-results-table .row-exact .td-diff { color: var(--cd-amber); }

    .cd-best-solution {
      background: var(--cd-amber-dim); border: 1px solid var(--cd-amber-border);
      border-radius: 10px; padding: 0.65rem 1rem; margin: 0.75rem 0;
      text-align: left; font-size: 0.84rem;
    }
    .cd-best-solution-label { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.07em; color: var(--cd-amber); margin-bottom: 0.25rem; }
    .cd-best-solution-expr  { font-family: monospace; color: var(--text); word-break: break-all; }

    /* Game over overlay */
    .cd-overlay-scores { margin: 1rem 0; text-align: left; }
    .overlay-score-row {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.4rem 0; border-bottom: 1px solid var(--border);
      font-size: 0.9rem;
    }
    .overlay-score-row:last-child { border-bottom: none; }
    .overlay-rank { width: 22px; text-align: center; color: var(--text-dim); font-size: 0.8rem; }
    .overlay-name { flex: 1; font-weight: 600; }
    .overlay-pts  { font-weight: 700; color: var(--yellow); }

    .btn {
      display: inline-block; padding: 0.6rem 1.5rem;
      border-radius: 10px; font-size: 0.95rem; font-weight: 700;
      cursor: pointer; border: none; transition: background 0.15s;
    }
    .btn-primary   { background: var(--cd-amber); color: #000; }
    .btn-primary:hover { background: var(--cd-amber-hover); }
    .btn-secondary { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { border-color: var(--cd-amber); color: var(--cd-amber); }
    .btn-full { width: 100%; margin-top: 0.5rem; padding: 0.7rem; }

    .back-link {
      display: inline-flex; align-items: center; gap: 0.4rem;
      color: var(--text-dim); text-decoration: none; font-size: 0.85rem;
      margin-bottom: 1rem; transition: color 0.15s;
    }
    .back-link:hover { color: var(--text); }

    .copy-btn {
      background: var(--surface2); border: 1px solid var(--border);
      color: var(--text-dim); padding: 0.35rem 0.75rem;
      border-radius: 6px; font-size: 0.8rem; cursor: pointer; transition: all 0.15s;
    }
    .copy-btn:hover { border-color: var(--cd-amber); color: var(--cd-amber); }

    @media (max-width: 640px) {
      .cd-main { grid-template-columns: 1fr; }
      .cd-sidebar { border-left: none; border-top: 1px solid var(--border); max-height: 220px; }
      .settings-grid { grid-template-columns: 1fr; }
      .cd-card { width: 58px; height: 58px; font-size: 1.3rem; }
      .cd-target-number { font-size: 2.8rem; padding: 0.3rem 1rem; }
    }
  </style>
</head>
<body>

  <!-- ‚îÄ‚îÄ Lobby ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="screen-lobby" class="screen">
    <div class="lobby-card">
      <a href="/" class="back-link">‚Üê Back to Home</a>
      <div class="cd-title">üéØ Countdown</div>
      <p class="cd-tagline">Six numbers, one target ‚Äî use +, ‚àí, √ó, √∑ to get as close as you can!</p>

      <!-- Direct-join panel (via invite link) -->
      <div id="lobby-direct-join" class="hidden">
        <p style="color:var(--text-dim);font-size:0.9rem;margin-bottom:1rem;text-align:center">You've been invited! Enter your name to jump in.</p>
        <div class="input-group">
          <label class="input-label">Your name</label>
          <input id="inp-username-direct" class="input-field" type="text" placeholder="Enter your name" maxlength="20" autocomplete="off" />
        </div>
        <button id="btn-direct-join" class="btn btn-primary btn-full">Join Game ‚Üí</button>
        <p style="text-align:center;margin-top:0.75rem">
          <button id="btn-back-to-lobby" style="background:none;border:none;color:var(--text-dim);font-size:0.85rem;cursor:pointer">‚Üê Back to lobby</button>
        </p>
      </div>

      <div id="lobby-username-step">
        <div class="input-group">
          <label class="input-label">Your name</label>
          <input id="inp-username" class="input-field" type="text" placeholder="Enter your name" maxlength="20" autocomplete="off" />
        </div>
        <button id="btn-continue" class="btn btn-primary btn-full">Continue ‚Üí</button>
      </div>

      <div id="lobby-choice-step" class="hidden">
        <div class="tabs">
          <button class="tab-btn active" data-tab="create">Create Room</button>
          <button class="tab-btn" data-tab="join">Join Room</button>
        </div>

        <!-- Create tab -->
        <div id="tab-create" class="tab-panel active">
          <div class="settings-grid">
            <div class="input-group">
              <label class="input-label">Rounds</label>
              <select id="inp-rounds" class="input-field">
                <option value="3">3 rounds</option>
                <option value="5" selected>5 rounds</option>
                <option value="7">7 rounds</option>
                <option value="10">10 rounds</option>
              </select>
            </div>
            <div class="input-group">
              <label class="input-label">Time per round</label>
              <select id="inp-time" class="input-field">
                <option value="20">20 seconds</option>
                <option value="30" selected>30 seconds</option>
                <option value="45">45 seconds</option>
                <option value="60">60 seconds</option>
              </select>
            </div>
          </div>
          <button id="btn-create" class="btn btn-primary btn-full">Create Room</button>
        </div>

        <!-- Join tab -->
        <div id="tab-join" class="tab-panel">
          <div class="input-group">
            <label class="input-label">Room code</label>
            <input id="inp-room-code" class="input-field" type="text" placeholder="e.g. ABCD23" maxlength="6"
              autocomplete="off" style="text-transform:uppercase;letter-spacing:0.1em" />
          </div>
          <button id="btn-join" class="btn btn-primary btn-full">Join Room</button>
        </div>
      </div>

      <p id="lobby-error" class="hidden" style="color:var(--accent);font-size:0.85rem;margin-top:0.75rem;text-align:center"></p>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Waiting Room ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="screen-waiting" class="screen hidden">
    <div class="lobby-card" style="width:520px">
      <a href="/" class="back-link" id="waiting-back-link">‚Üê Leave room</a>
      <div class="cd-title">üéØ Countdown</div>
      <div class="room-code-display">
        <div class="code-label">Room Code</div>
        <div class="code" id="waiting-room-code">------</div>
        <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:0.4rem">
          <button class="copy-btn" id="btn-copy-code">Copy Code</button>
          <button class="copy-btn" id="btn-copy-link">üîó Invite Link</button>
        </div>
        <p id="link-copied-msg" class="hidden" style="font-size:0.75rem;color:var(--green);margin-top:0.3rem">Link copied!</p>
      </div>

      <div class="player-list">
        <div class="player-list-title">Players (<span id="waiting-player-count">0</span>)</div>
        <div class="player-list-items" id="waiting-players"></div>
      </div>

      <p id="waiting-hint" style="font-size:0.8rem;color:var(--text-dim);text-align:center;margin-bottom:0.75rem">
        Share the room code with friends!
      </p>

      <button id="btn-start" class="btn btn-primary btn-full hidden">Start Game</button>
      <p id="waiting-not-owner" class="hidden" style="text-align:center;color:var(--text-dim);font-size:0.85rem">
        Waiting for the host to start‚Ä¶
      </p>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Game Screen ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="screen-game" class="hidden" style="display:none">

    <!-- Top bar -->
    <div class="cd-topbar">
      <div class="cd-round-info">
        <a href="/" style="color:var(--text-dim);text-decoration:none;font-size:0.85rem;transition:color 0.15s"
           onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--text-dim)'">‚åÇ Home</a>
        <span>Round <strong id="hud-round">1</strong> / <span id="hud-total-rounds">5</span></span>
      </div>
      <div style="font-size:1.1rem;font-weight:900;letter-spacing:-0.01em">üéØ Countdown</div>
      <div style="display:flex;align-items:center;gap:0.75rem">
        <div class="cd-timer-wrap">
          <svg class="cd-timer-svg" viewBox="0 0 52 52">
            <circle class="cd-timer-track" cx="26" cy="26" r="22"/>
            <circle class="cd-timer-arc" id="timer-arc" cx="26" cy="26" r="22"
              stroke-dasharray="138.2" stroke-dashoffset="0"/>
          </svg>
          <div class="cd-timer-num" id="hud-timer">30</div>
        </div>
        <span id="mute-btn-anchor"></span>
      </div>
    </div>

    <!-- Main layout -->
    <div class="cd-main">

      <!-- Center panel -->
      <div class="cd-center">
        <div class="cd-target-wrap">
          <div class="cd-target-label">Target</div>
          <div class="cd-target-number" id="cd-target">---</div>
        </div>

        <!-- 6 Number cards -->
        <div class="cd-cards" id="cd-cards"></div>

        <!-- Expression input -->
        <div class="cd-expr-wrap" id="cd-expr-wrap">
          <input id="cd-expr-input" class="cd-expr-input"
            type="text" placeholder="e.g. (25+50)*3‚àí75" autocomplete="off" spellcheck="false" />
          <div class="cd-expr-result" id="cd-expr-result"></div>
        </div>

        <!-- Operator buttons -->
        <div class="cd-ops">
          <button class="cd-op-btn" data-insert="+">+</button>
          <button class="cd-op-btn" data-insert="-">‚àí</button>
          <button class="cd-op-btn" data-insert="*">√ó</button>
          <button class="cd-op-btn" data-insert="/">/</button>
          <button class="cd-op-btn" data-insert="(">(</button>
          <button class="cd-op-btn" data-insert=")">)</button>
          <button class="cd-op-btn" id="op-del">‚å´</button>
          <button class="cd-op-btn" id="op-clear">C</button>
        </div>

        <button id="cd-submit-btn" class="cd-submit-btn" disabled>Submit &amp; Lock In</button>
        <div class="cd-feedback" id="cd-feedback"></div>
      </div>

      <!-- Sidebar -->
      <div class="cd-sidebar">
        <div class="cd-sidebar-section">
          <div class="cd-sidebar-title">Players</div>
          <div class="cd-player-status-list" id="cd-player-status-list"></div>
        </div>
        <div class="cd-recap" id="cd-recap" style="display:none">
          <div class="cd-recap-title">Last Round</div>
          <div id="cd-recap-content"></div>
        </div>
      </div>

    </div>
  </div>

  <!-- ‚îÄ‚îÄ Pick Phase Overlay ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="overlay-pick" class="cd-overlay hidden">
    <div class="cd-overlay-card">

      <!-- Shown to the picker -->
      <div id="pick-my-turn" class="hidden">
        <div class="cd-overlay-title">Your turn to pick!</div>
        <div class="cd-overlay-sub">How many large numbers? (25, 50, 75, 100)<br>Auto-picks 2 large in <span id="pick-auto-secs">10</span>s</div>
        <div class="cd-pick-btns">
          <div>
            <button class="cd-pick-btn" data-large="0">0</button>
            <div class="cd-pick-btn-label">all small</div>
          </div>
          <div>
            <button class="cd-pick-btn" data-large="1">1</button>
            <div class="cd-pick-btn-label">+ 5 small</div>
          </div>
          <div>
            <button class="cd-pick-btn" data-large="2">2</button>
            <div class="cd-pick-btn-label">+ 4 small</div>
          </div>
          <div>
            <button class="cd-pick-btn" data-large="3">3</button>
            <div class="cd-pick-btn-label">+ 3 small</div>
          </div>
          <div>
            <button class="cd-pick-btn" data-large="4">4</button>
            <div class="cd-pick-btn-label">all large</div>
          </div>
        </div>
      </div>

      <!-- Shown to other players -->
      <div id="pick-waiting" class="hidden">
        <div class="cd-overlay-title">Numbers incoming‚Ä¶</div>
        <div class="cd-overlay-sub"><strong id="pick-picker-name">‚Äî</strong> is choosing the numbers</div>
        <div class="cd-spinner"></div>
        <div class="cd-pick-counter" id="pick-round-info"></div>
      </div>

    </div>
  </div>

  <!-- ‚îÄ‚îÄ Round End Overlay ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="overlay-round-end" class="cd-overlay hidden">
    <div class="cd-overlay-card">
      <div class="cd-overlay-title" id="round-end-title">Round Complete!</div>
      <div id="round-end-target" style="font-size:0.9rem;color:var(--text-dim);margin-bottom:0.75rem"></div>

      <table class="cd-results-table" id="round-end-table">
        <thead>
          <tr>
            <th>Player</th>
            <th>Expression</th>
            <th>Result</th>
            <th>Off by</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody id="round-end-tbody"></tbody>
      </table>

      <div class="cd-best-solution" id="round-end-best">
        <div class="cd-best-solution-label">Server's best solution</div>
        <div class="cd-best-solution-expr" id="round-end-best-expr">‚Äî</div>
      </div>

      <p style="color:var(--text-dim);font-size:0.85rem;margin-top:0.75rem" id="round-end-next"></p>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Game Over Overlay ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="overlay-game-over" class="cd-overlay hidden">
    <div class="cd-overlay-card">
      <div style="font-size:2.5rem;margin-bottom:0.5rem">üèÜ</div>
      <div class="cd-overlay-title" id="game-over-title">Game Over!</div>
      <div class="cd-overlay-scores" id="game-over-scores"></div>
      <div style="margin-top:1.25rem;display:flex;gap:0.75rem;justify-content:center">
        <button id="btn-play-again" class="btn btn-primary">Play Again</button>
        <a href="/" class="btn btn-secondary">Home</a>
      </div>
      <p style="color:var(--text-dim);font-size:0.8rem;margin-top:0.75rem" id="game-over-countdown"></p>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/sounds.js"></script>
  <script src="/countdown.js"></script>
  <script>mountMuteBtn(document.getElementById('mute-btn-anchor'));</script>
</body>
</html>
